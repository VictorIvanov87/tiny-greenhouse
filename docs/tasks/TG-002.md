# TG-002 — Firebase Auth: Email/Password + Google (UI + wiring)

**Goal**  
Implement real authentication using **Firebase Auth**. Users can **sign up** and **sign in** with **email/password** and **Google**. Show validation (password ≥ 8 chars) and friendly error messages for wrong credentials.

> Follow `frontend/AGENTS.md` (layout/structure) and keep changes inside the frontend only.

---

## Scope
- Add Firebase client SDK (modular v10) and configuration.
- Email/Password: **Sign Up** and **Sign In** flows.
- Google: **Sign In/Up** via `GoogleAuthProvider` (one button “Continue with Google”).
- Auth state management with a React context (`AuthProvider`) + `useAuth()` hook.
- Route guard: unauthenticated visitors are redirected to `/login`; authenticated users can access private routes.
- Validation & errors:
  - Password must be **≥ 8 chars** (client-side hint + disabled submit until valid).
  - Map Firebase errors to friendly messages (e.g., wrong-password, user-not-found, email-already-in-use).

## Out of Scope
- Backend custom tokens, Firestore/DB, profile pages, social providers beyond Google.
- Persisting extra profile data; advanced validation libraries.
- Server-side rendering or cookies; keep the SPA.

---

## Dependencies
- Install:
  ```bash
  npm i firebase
  ```

## Env & Config
Create/update `./frontend/.env.example` with public Firebase config (no secrets, but must restrict origins in Firebase Console):
```
VITE_FIREBASE_API_KEY=
VITE_FIREBASE_AUTH_DOMAIN=
VITE_FIREBASE_PROJECT_ID=
VITE_FIREBASE_APP_ID=
```
> Note: Firebase web config is **public by design**. Restrict domains in Firebase Console.

---

## Files to Create/Modify (suggested)
- `src/features/auth/firebase.ts` — initialize Firebase app + `getAuth()`.
- `src/features/auth/auth-context.tsx` — `AuthProvider` with `onAuthStateChanged`, exposes `{ user, loading }`.
- `src/features/auth/hooks/useAuth.ts` — simple hook wrapper.
- `src/features/auth/api.ts` — thin wrappers:
  - `signInWithEmail(email, password)`
  - `signUpWithEmail(email, password)`
  - `signInWithGoogle()` (via `signInWithPopup` + `GoogleAuthProvider`)
  - `signOutUser()`
- `src/app/providers.tsx` — wrap app with `AuthProvider`.
- `src/app/routes.tsx` — update guard to read `useAuth()`; `/login` remains public.
- `src/features/auth/components/AuthCard.tsx` — extend TG-001 UI:
  - Disable submit when password < 8 chars (sign-up and sign-in forms).
  - Show firebase error messages in a `HelperText`/`Alert`.
  - Add **“Continue with Google”** button.
- (Optional) `src/shared/ui/Alert.tsx` — thin wrapper over Flowbite Alert for consistent styling.

---

## UI/UX Requirements
- Keep **Flowbite React** components (Card, Button, TextInput, Label, Alert/HelperText).
- Validation:
  - Realtime hint: “Password must be at least 8 characters.” (sign-up and sign-in).
  - Disable submit if invalid; show error banner for Firebase auth failures.
- Google button (“Continue with Google”) visually distinct and accessible.
- After **Sign In** (email or Google) → navigate to `/`.
- After **Sign Up (email)** → auto sign in (default Firebase behavior) → navigate to `/`.

---

## Steps (Execution Plan)
1. **Firebase init:** create `firebase.ts` using Vite env vars; export `auth`.
2. **Auth context:** `AuthProvider` subscribes to `onAuthStateChanged(auth, ...)`, stores `{ user, loading }` and provides context.
3. **API wrappers:** implement `signInWithEmailAndPassword`, `createUserWithEmailAndPassword`, `signInWithPopup(new GoogleAuthProvider())`, and `signOut` in `api.ts`. Map common errors to friendly text.
4. **Routes/guard:** in `routes.tsx`, wrap private routes with a guard that reads from `useAuth()`:
   - If `loading`, render a skeleton/spinner.
   - If `!user`, redirect to `/login`.
5. **UI wiring:** update `AuthCard` to call wrappers. Add password length check (≥ 8) and show errors via Flowbite `Alert`/`HelperText`. Add “Continue with Google”.
6. **Smoke checks** (see below).

---

## Error Mapping (examples)
- `auth/invalid-credential`, `auth/wrong-password` → “Incorrect email or password.”
- `auth/user-not-found` → “Account not found. Try Sign up.”
- `auth/email-already-in-use` → “Email already in use.”
- `auth/popup-closed-by-user` → ignored (no banner).

---

## Smoke Checks (must pass)
- `npm run dev` boots with no red console errors.
- `/login` loads; flipping card works; Google button visible.
- Sign Up (email) with short password shows inline hint and disables submit.
- Sign Up (email) with >= 8 chars creates user and navigates to `/`.
- Sign In (email) with correct creds navigates to `/`; wrong creds show friendly error.
- Google Sign In authenticates and navigates to `/`.
- Visiting a protected route when logged out redirects to `/login`.
- Refresh preserves session (Firebase handles persistence).

---

## Notes for Agents
- Keep diffs focused; do not reformat unrelated files.
- Do not introduce new UI libraries; stick to Flowbite + Tailwind.
- Place Firebase config in a **single** module (`firebase.ts`) and import from there.
- Ensure TypeScript types are correct (no `any` in public APIs).
