TG-022 — Frontend: Setup Step 2 wired to Crop Defaults (+ mini-chat)

Goal
Use the new backend endpoint GET /api/crops/:cropId/:variety/defaults to power Setup Wizard Step 2. Let the user pick a crop/variety, preview deterministic defaults (environment, irrigation, container, safety bounds, stages), and ask quick questions via the assistant. On confirmation, persist the selection and initialize the greenhouse.

Scope
- Route: /setup (existing wizard).
- Implement Step 2 UI (Crop & Variety):
  • Left pane: crop selector (Chillies ▸ Basket of Fire / Prairie Fire; Basil ▸ Genovese; Mushrooms ▸ Oyster / Shiitake — the latter two can be disabled or marked “not supported in this prototype”).
  • When a variety is selected, fetch defaults from `/api/crops/:cropId/:variety/defaults` and render a read-only preview card with:
    - Overview (first paragraph),
    - Defaults.environment (temperature_day/night, humidity, light_hours),
    - Defaults.irrigation (method, frequency),
    - Container (volume/diameter/depth when present),
    - Safety bounds (show as badges or small chips),
    - Stages list (id/label only, collapsed by default).
  • Right pane: compact “Ask Assistant” box (textarea + Send) that posts to `/api/assist` with { message, cropId, variety, topK: 6, temperature: 0.2 } and shows 1 assistant reply with citations (no history needed here; full chat stays at /assistant).

- Step 3 UI (Alarms & Preferences — skeleton only):
  • Render sliders/inputs with prefilled defaults from Step 2 where relevant (e.g., light_hours). Validation must respect safety_bounds: warn when outside but allow override.
  • For this ticket, store values locally in wizard state; real persistence happens on Finish.

- Finish (Step 4):
  • On Confirm, call `PUT /api/greenhouses/current` with the new selection:
    {
      id: "gh-1",
      name: "Tiny Greenhouse #1",
      method: "soil",
      plantType: <variety>,
      cropId: <cropId>,
      variety: <variety>,
      growthStage: "germination",
      language: "en",
      timelapse: { enabled: true, hour: 9 }
    }
  • Also persist a minimal user settings doc to Firebase (if available): `users/{uid}/settings` with { cropId, variety, language, notifications: { email: false, push: false } }.
  • Redirect to /dashboard and hide /setup from the sidebar when a greenhouse has cropId+variety set.

UI/Dev notes
- Use Flowbite React components (Sidebar, Card, ListGroup, Badge, Alert, Button, Spinner).
- Respect full-height shell; keep the wizard sticky header and step indicator.
- Error handling:
  • 404 from defaults → show “The selected variety has no dataset yet.”
  • Network errors → toast + retry button on the card.
- Local state:
  • Wizard state should live in a small store/context under `src/features/setup/state.ts` (serializable, also persisted to localStorage with a versioned key `tg-setup-v1`).
- API modules:
  • `src/features/setup/api.ts` — functions: `getCropDefaults(cropId, variety)`, `updateGreenhouse(payload)`.

Acceptance
- Selecting “Chillies ▸ Basket of Fire” renders defaults within 1s and a small list of safety bounds and stages.
- Sending a question in the mini-chat returns an assistant reply with ≥1 citation when RAG has chunks.
- Clicking Confirm writes the greenhouse via PUT and routes to /dashboard.
- After confirmation, the sidebar no longer shows “Setup Wizard” (or it routes back to /dashboard if visited directly).

Out of scope
- Full-blown alarms logic or notifications delivery (placeholder inputs only).
- Streaming chat, chat history, or advanced assistant tools.
- Mushrooms: keep as disabled/not supported visuals only for now.

Files to touch (indicative)
- `src/features/setup/SetupWizard.tsx` (Step 2 & 3 content areas)
- `src/features/setup/api.ts`
- `src/features/setup/state.ts`
- `src/features/assistant/MiniAssist.tsx` (simple component used only in the wizard)
- `src/shared/ui/*` if small UI wrappers are useful

Testing
- Manual: switch among Genovese, Basket of Fire, Prairie Fire and verify defaults render and validation warnings trigger when editing light_hours out of bounds.
- Verify that after finishing the wizard, reloading the app lands you on /dashboard (not /setup).
